# 决策方法论-HW2

### 问题描述

某地 $A$ 发生了一场地震，为了尽快进行灾后救援，政府需要从灾区外某地 $B$ 向灾区运送救援物资，而地震后五天内的救援是十分重要的因此，我们模拟一个向震区运送物资的情景，并考虑如何在五天内运送尽可能多的物资.

假设从 $B$ 地前往 $A$ 地的道路大多被地震破坏封堵，眼下还有两条路径，分别标记为 $M$ 和 $N$ .$B$地一共有 $1000$ 辆汽车可用于物资运输，并且通过 $M$ 、 $N$ 路径前往 $A$ 地往返一次都只需要一天的时间.

- $M$ 路受地震影响较小，路况较好，汽车往返一次不发生故障的概率 $\beta=0.9$ 但是 $M$ 路需要通过一座受过地震影响的桥梁，为了保障桥梁的安全， $M$ 路上的汽车载重不能超过 $5$ 吨.
- $N$ 路不需要通过这样的桥梁，汽车可以满载 $8$ 吨，但是由于 $N$ 路受地震影响较大，路况较差，往返一次后车辆不发生故障的概率 $\alpha=0.7$ .

在这紧张的五天内，每天晚上都会对所有的汽车进行检修，若没有发生故障可以将汽车状态恢复如初；一旦发生故障，简单的检修不足以让该车辆在五天内恢复正常工作.假设发生故障的汽车可以顺利完成本次运输任务并成功返回 $B$ 地。

显然，分配不同数目的车辆分别从 $M$ 、 $N$ 两条路同时向灾区运送物资才能在五天内运送更多的物资，而如何分配两条路上车辆的比例则是我们需要解决的问题

### 问题分析

从假设中可以看出，五天内的分配策略之间是无后效性的，可以考虑用马尔科夫决策过程进行分析

首先，对此过程进行一些假设

设阶段 $k$ 表示天数，则 $k=1,2,3,4,5$ ；状态变量 $S_k$ 表示第 $k$ 天初所拥有的未发生故障的车辆数目，亦即 $k-1$ 晚上未发生故障的车辆数目；决策变量 $x_k$ 表示在第 $k$ 天分配从 $N$ 路前往灾区的车辆数目，同时得到 $S_k-x_k$ 为当日分配从 $M$ 路前往灾区的车辆数目

可得状态转移方程为：

$S_{k+1}=\alpha x_k+\beta (S_k−x_k)=0.7x_k+0.9(S_k−x_k)=0.9S_k−0.2x_k$

允许决策的集合为：

$A_k(S_k)=\{x_k:0\leq x_k \leq S_k\}$

设一个阶段指标$g_k(S_k,x_k)$作为每天的收益，由于每天的收益是由当天的决策和状态决定的，因此：

$g_k(S_k,x_k)=8x_k+5(S_k-x_k)=5S_k+3x_k$

由于每天的决策都是相互独立的，因此可以将五天的目标函数相加，得到总的目标函数为：

$G(S,x)=\sum_{k=1}^{5}G_k(S_k,x_k)=5\sum_{k=1}^{5}S_k+3\sum_{k=1}^{5}x_k$

设有最优函数$J_k(S_k)$表示第$k$天初状态为$S_k$时的最优值，得到贝尔曼方程为

$J_k(S_k)=\max_{x_k\in A_k(S_k)}\{g_k(S_k,x_k)+J_{k+1}(S_k+1)\}$

边界条件为：

$J_6(S_6)=0$

### 求解

使用MDP的逆推归纳法，从第五天开始，逐步向前推导，得到最优决策

$J_5(S_5)=\max_{x_5\in A_5(S_5)}\{g_5(S_5,x_5)+J_6(S_6)\}$

$J_5(S_5)=\max_{x_5\in A_5(S_5)}\{g_5(S_5,x_5)\}$

$J_5(S_5)=\max_{x_5\in A_5(S_5)}\{5S_5+3x_5\}$

此时显然有$J_5(S_5)$是关于$x_5$的线性函数，因此当$S_5\geq 0$时，$J_5(S_5)$在$A_5(S_5)$上取最大值时，$x_5^*=S_5$，此时

$J_5(S_5)=8S_5=8(0.9S_4-0.2x_4)$

在$k=4$时，$J_4(S_4)$的表达式为

$J_4(S_4)=\max_{x_4\in A_4(S_4)}\{g_4(S_4,x_4)+J_5(S_5)\}$

$J_4(S_4)=\max_{x_4\in A_4(S_4)}\{5S_4+3x_4+8(0.9S_4-0.2x_4)\}$

$J_4(S_4)=\max_{x_4\in A_4(S_4)}\{12.2S_4+1.4x_4\}$

此时显然有$J_4(S_4)$是关于$x_4$的线性函数，因此当$S_4\geq 0$时，$J_4(S_4)$在$A_4(S_4)$上取最大值时，$x_4^*=S_4$，此时

$J_4(S_4)=13.6S_4=13.6(0.9S_3-0.2x_3)$

在$k=3$时，$J_3(S_3)$的表达式为

$J_3(S_3)=\max_{x_3\in A_3(S_3)}\{g_3(S_3,x_3)+J_4(S_4)\}$

$J_3(S_3)=\max_{x_3\in A_3(S_3)}\{5S_3+3x_3+13.6(0.9S_3-0.2x_3)\}$

$J_3(S_3)=\max_{x_3\in A_3(S_3)}\{17.24S_3+0.28x_3\}$

此时显然有$J_3(S_3)$是关于$x_3$的线性函数，因此当$S_3\geq 0$时，$J_3(S_3)$在$A_3(S_3)$上取最大值时，$x_3^*=S_3$，此时

$J_3(S_3)=17.52S_3=17.52(0.9S_2-0.2x_2)$

在$k=2$时，$J_2(S_2)$的表达式为

$J_2(S_2)=\max_{x_2\in A_2(S_2)}\{g_2(S_2,x_2)+J_3(S_3)\}$

$J_2(S_2)=\max_{x_2\in A_2(S_2)}\{5S_2+3x_2+17.52(0.9S_2-0.2x_2)\}$

$J_2(S_2)=\max_{x_2\in A_2(S_2)}\{20.768S_2-0.504x_2\}$

此时显然有$J_2(S_2)$是关于$x_2$的线性函数，因此当$S_2\geq 0$时，$J_2(S_2)$在$A_2(S_2)$上取最大值时，$x_2^*=0$，此时

$J_2(S_2)=20.768S_2=20.768(0.9S_1-0.2x_1)$

在$k=1$时，$J_1(S_1)$的表达式为

$J_1(S_1)=\max_{x_1\in A_1(S_1)}\{g_1(S_1,x_1)+J_2(S_2)\}$

$J_1(S_1)=\max_{x_1\in A_1(S_1)}\{5S_1+3x_1+20.768(0.9S_1-0.2x_1)\}$

$J_1(S_1)=\max_{x_1\in A_1(S_1)}\{23.6912S_1-1.1536x_1\}$

此时显然有$J_1(S_1)$是关于$x_1$的线性函数，因此当$S_1\geq 0$时，$J_1(S_1)$在$A_1(S_1)$上取最大值时，$x_1^*=0$，此时

$J_1(S_1)=23.6912S_1$

因此，当$S_1\geq 0$时，$J_1(S_1)$在$A_1(S_1)$上取最大值时，$x_1^*=0$，$x_2^*=0$，$x_3^*=S_3$，$x_4^*=S_4$，$x_5^*=S_5$，此时

$J_1(S_1)=23.6912S_1$

带入$S_1=1000$，得到$J_1(1000)=23691.2$

此即为没有$S_6$限制下的最优解

### 加上限制重新决策

现在，要求$S_6\geq350$。所以这个条件无法满足。因此，我们需要调整策略。考虑在第三天也让一部分车辆走M路，即$x_3 < S_3$。

我们可以设$x_3 = S_3 - y$，其中$y$是第三天走N路的车辆数目。然后，我们可以通过调整$y$的值来满足$S_6\geq350$的条件。

计算车辆的个数

$S_3=0.9S_2-0.2x_2=0.9(0.9S_1-0.2x_1)-0.2x_2=0.81S_1-0.18x_1-0.2x_2$

故$S_3=0.81S_1=810$

我们可以得到$y$的取值范围为$0\leq y \leq 810$。

故$S_4=0.9S_3-0.2x_3=0.9S_3-0.2y$

$S_5=0.9S_4-0.2x_4=0.9S_4-0.2S_4=0.7S_4$

$S_5=0.7(0.9S_3-0.2y)=0.63S_3-0.14y$

$S_6=0.9S_5-0.2x_5=0.9S_5-0.2S_5=0.7S_5$

$S_6=0.7(0.63S_3-0.14y)=0.441S_3-0.098y$

又有$S_6\geq350$，故$0.441S_3-0.098y\geq350$

$y\leq\frac{0.441S_3-350}{0.098}$

$y\leq\frac{0.441\times810-350}{0.098}=0.441\times810-350$

解得$y\leq 73.57$

为了保证有足够的车辆在第六天，我们可以让$y$取最大值，即$y=73$。

### 重新计算最优解

这时，我们可以得到每一天的运输量

$S_1=1000,x_1=0,J_1(S_1)=5*1000=5000$

$S_2=900,x_2=0,J_2(S_2)=5*900=4500$

$S_3=810,x_3=73,J_3(S_3)=5*737+8*73=3685+584=4269$

$S_4=714.4，x_4=714.4,J_4(S_4)=8*714.4=5715.2$

$S_5=500.08,x_5=500.08,J_5(S_5)=8*500.08=4000.64$

则总的运输量为$5000+4500+4269+5715.2+4000.64=23485.84$

### 结论

最优的运输量为23485.84

此时的决策方案为：在第一天和第二天，所有车辆都走M路；在第三天，有73辆车走N路，其余车辆走M路；在第四天和第五天，所有车辆都走N路。